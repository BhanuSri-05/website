Ë
    £S^h£  ã                   óè   — d dl mZmZ d dlmZ d dlZd dlZ eddg¬«      Z  G d „ de«      Zde	d	e	fd
„Z
d
„ Z
 e
«        e j                  d«      d
efd„«       Z
e j                  d«      d
efd„«       Zy)é    )Ú	APIRouterÚ
HTTPException)Ú	BaseModelNz/userÚUser)ÚprefixÚtagsc                   ó"   — e Zd ZU eed<   eed<   y)r   ÚemailÚpasswordN)Ú__name__Ú
__module__Ú__qualname__ÚstrÚ__annotations__© ó    úJC:\Users\iswarya\OneDrive\Desktop\Edu_Tutor-AI\backend\routes\user_auth.pyr   r      s   … Ø
ƒJØ„Mr   r
   Úreturnc                 ód   — t        j                  | j                  «       «      j                   «       S )N)Ú hashlibÚsha256ÚencodeÚ	hexdigest)r
   s    r   Ú
hash_passwordr      s!   € Ü
>‰>˜(Ÿ/™/Ó+Ó
,×
6Ñ
6Ó
8Ð8r   c                  ó°   — t        j                  d«      } | j                  «       }|j                   d«       | j	                  «        | j
                  «        y )Nú
students.dbz^CREATE TABLE IF NOT EXISTS users (
        email TEXT PRIMARY KEY,
        password TEXT
    ))Ú sqlite3Ú connectÚcursorÚ executeÚcommitÚclose)ÚconnÚcs     r   Úinit_manual_user_dbr%      s@   € Ü
?‰?˜=Ó
)€DØ
‰
‹
€AØ‡IIð 	ô 
ð 	‡KK„MØ‡JJ…Lr   z	/registerÚuserc                  óŠ  — t        j                  d«      }|j                  «       }|j                   d| j                  f«       |j
                  «       r|j
                  «        t        dd¬«      ‚|j                   d| j                  t        | j                  «      f«       |j                  «        |j
                  «        d diS )	Nr   z!SELECT * FROM users WHERE email=?i  zUser already exists©Ú
status_codeÚdetailz1INSERT INTO users (email, password) VALUES (?, ?)Ú messageu   âœ… Registration successful!)
r   r   r   r    r
   Úfetchoner"   r   r   r
   r!   )r&   r#   r$   s      r   Úregisterr-   "   s’   € ä
?‰?˜=Ó
)€DØ
‰
‹
€AØ‡IIÐ1°D·J±J°=ÔAØ ‡zz„|Ø
‰
ŒÜ¨Ð4IÔJÐJà‡IIÐAØz‰zœ=¨¯©Ó7Ð8ô:à‡KK„MØ‡JJ„LØÐ5Ð
6Ð6r   z/loginc                 ó"  — t        j                  d«      }|j                  «       }|j                   d| j                  f«       |j
                  «       }|j
                  «        |r|d   t        | j                  «      k(  rddiS t        dd ¬«      ‚)	Nr   z(SELECT password FROM users WHERE email=?r   r+   u   âœ… Login successful!i‘  zInvalid email or passwordr(   )
r   r   r   r    r
   r,   r"   r   r
   r   )r&   r#   r$   Úresults       r   Úloginr0   2   su   € ä
?‰?˜=Ó
)€DØ
‰
‹
€AØ‡IIÐ8¸4¿:¹:¸-ÔHØ
Z‰Z‹\€FØ‡JJ„Lá 
&˜‘)œ}¨T¯]©]Ó;Ò;ØÐ2Ð3Ð3Ü
 CÐ0KÔ
LÐLr   )Ú fastapir   r   Úpydanticr   r   r   Úuser_auth_routerr   r   r   r%   Úpostr-   r0   r   r   r   ú<module>r5      sŸ   ðß ,Ý Û Û áØ
Ø
ˆôÐ ôˆ9ô ð
9˜Cð 9 Có 9òñ Ô ð ×Ñ{Ó#ð74ò 7ó $ð7ð ×ÑxÓ ð	Mò 	Mó !ñ	Mr   
