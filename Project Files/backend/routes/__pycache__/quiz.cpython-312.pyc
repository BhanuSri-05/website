Ã‹
    ÃšÃ ^h  Ã£                   Ã³Ã€   â€” d dl mZmZ d dlmZ d dlmZ d dl Z d dlZd dl	Z	d dl
Z
 eÂ«         eddgÂ¬ Â«      Z
 G dâ€ d	eÂ«      Zd
â€ Z
e
j                  d
Â«      defd
â€Â«       Zy)Ã©    )Ãš	APIRouterÃš
HTTPException)Ãš	BaseModel)Ãš
load_dotenvNz/quizÃšQuiz)ÃšprefixÃštagsc                   Ã³"   â€” e Zd ZU eed<   eed<   y)Ãš
QuizRequestÃštopicÃš
num_questionsN)Ãš__name__Ãš
__module__Ãš__qualname__ÃšstrÃš__annotations__ÃšintÂ© Ã³    ÃºÂC:\Users\Lucky\Downloads\EduTutor-AI-Personalized-Learning-with-Generative-AI-and-LMS-Integration-main\edu\Project Files\backend\routes\quiz.pyr
   r
      s
   â€¦ Ã˜
Æ’JÃ˜Ã”r   r
   c                  Ã³Ã¢   â€” d} ddi}t        j                  dÂ«      ddÅ“}t        j                  | ||Â¬ Â«      }|j                  dk(  r|j
                  Â«       d	   S t
        d
|j                  â€º ÂÂ«      â€š)
Nz(https://iam.cloud.ibm.com/identity/tokenÃºContent-Typez!application/x-www-form-urlencodedÃšWATSONX_API_KEYz&urn:ibm:params:oauth:grant-type:apikey)ÃšapikeyÃš
grant_type)Ãš headersÃšdataÃ©Ãˆ   Ãšaccess_tokenzFailed to get IBM token: )ÃšosÃšgetenvÃšrequestsÃšpostÃš
status_codeÃšjsonÃš	ExceptionÃštext)Ãšurlr   r   Ãšresponses       r   Ãš
get_ibm_tokenr*      ss   â‚¬ Ã˜
4â‚¬CÃ˜ÃBÃCâ‚¬GÃ¤â€”)â€˜)Ã-Ã“.Ã˜>Ã±â‚¬DÃ´ Â}â€°}ËœSÂ¨'Â¸Ã”=â‚¬HÃ˜ Ã— Ã‘ ËœsÃ’ "Ã˜Â}â€°}â€¹Ëœ~Ã‘.Ã.Ã¤Ã3Â°HÂ·MÂ±MÂ°?ÃCÃ“DÃDr   z	/generateÃš payloadc                 Ã³v  â€” d| j                   â€º dÂ}d|â€º d| j                  â€º dÂ}t        Â«       }t         j                  dÂ«      â€º d Â}d|â€º Âd	d
Å“}t         j                  d
Â«      |dd
dÅ“t         j                  dÂ«      dÅ“}t
        j                  |||Â¬Â«      } | j                  dk(  rÂ£	 | j                  Â«       d   d   d   }t        |t        t        fÂ«      r|d   }	n|}	t        d|	Â«       t        j                  d|	t        j                  Â«      }
|
s
t!        dÂ«      â€š|
j#                  dÂ«      }
	 	 t        j$                  |
Â«      }	 d|iS y # t        j&                  $ r1 |
j)                  Â«       d d }
t+        |
Â«      dk  r
t-        ddÂ¬Â«      â€šY nw xY wÅ’d# t.        $ r}
t-        ddt1        |
Â«      â€º ÂÂ¬Â«      â€šd }
~
ww xY w) Nz)This is some basic content on the topic: Ãº.z/Use the following content to generate a quiz:

z


Generate af   multiple choice questions (MCQs). For each question, include:
- 'question': the text of the question
- 'options': a list of 4 answer choices
- 'answer': the correct answer
Return ONLY a valid JSON array of question objects. No explanation. No markdown. No code block.
Do not wrap it in a Python tuple or return extra text. Do not truncate the last question.ÃšWATSONX_ENDPOINTz)/ml/v1/text/generation?version=2023-05-29z Bearer zapplication/json)Ãš
Authorizationr   ÃšWATSONX_MODEL_IDÃšgreedyiÃœ  )Ãšdecoding_methodÃšmax_new_tokensÃšWATSONX_PROJECT_ID)Ãšmodel_idÃšinputÃš
parametersÃš
project_id)r   r%   r   Ãš resultsr   Ãšgenerated_textu   Ã°Å¸â€Â WatsonX output:
z\[\s*{.*?}\s*\]z,No valid JSON array found in WatsonX output.Ã©Ã¿Ã¿Ã¿Ã¿Ã©
   iÃ´  zOutput too corrupted to parse.)r$   ÃšdetailÃš	questionsz Failed to parse WatsonX output: )r   r
   r*   r    r!   r"   r#   r$   r%   Ãš
isinstanceÃštupleÃšlistÃšprintÃšreÃšsearchÃšDOTALLÃš
ValueErrorÃšgroupÃšloadsÃšJSONDecodeErrorÃšstripÃšlenr   r&   r   )r+   Ãšcourse_materialsÃšpromptÃš	ibm_tokenr(   r   Ãšpayload_datar)   Ãš
raw_outputÃšraw_textÃšmatchÃšcleaned_json_strr>   Ãšes                 r   Ãš
generate_quizrU   $   s   â‚¬ Ã°H CÃ€7Ã‡=Ã=Ã€/ÃQRÃSÃÃ° 
<Ã˜
Ã
Ã° Ã˜Ã—)Ã‘)Ã*Ã° +dÃ°	eÃ° 
Ã´ â€œâ‚¬IÃœ
ÂYâ€°YÃ)Ã“
*Ã+Ã+TÃ
Uâ‚¬CÃ "Â 9Â +Ã.Ã˜*Ã±â‚¬GÃ´
 â€”Iâ€˜IÃ0Ã“1Ã˜Ã 'Ã˜"Ã±
Ã´ â€”iâ€˜iÃ 4Ã“5Ã±â‚¬LÃ´ Â}â€°}ËœSÂ¨'Â¸Ã”Eâ‚¬HÃ˜ Ã— Ã‘ ËœsÃ’ "Ã°	eÃ˜!Å¸â„¢â€ºÂ¨Ã‘3Â°AÃ‘6Ã7GÃ‘HË†JÃœËœ*Â¤uÂ¬dÂ mÃ”4Ã˜%Â aâ„¢=â€˜Ã %ÂÃœÃ*Â¨HÃ”5Ã¤â€”Iâ€˜IÃ0Â°(Â¼BÂ¿IÂ¹IÃ“FË†EÃ™Ãœ Ã!OÃ“PÃPÃ˜$Å¸{â„¢{Â¨1â€º~ÃÃ˜Ã°fÃœ $Â§
Â¡
Ã+;Ã“ <ÂIÃ˜Ã°  Â Ã+Ã+Ã°- #Ã¸Ã´" Ã—+Ã‘+Ã² fÃ˜'7Ã—'=Ã‘'=Ã“'?Ã€Ã€Ã'DÃ$ÃœÃ+Ã“,Â¨rÃ’1Ãœ+Â¸ÃDdÃ”eÃeÃ± 2Ã°fÃºÃ°	 Ã¸Ã´ Ã² 	eÃœÂ¨CÃ:ZÃ”[^Ã_`Ã“[aÃZbÃ8cÃ”dÃdÃ»Ã°	eÃºs>   Ã‚&B F Ã„.E	 Ã…F Ã…	AF
Ã†
F Ã†F
Ã†
F Ã†	F8Ã†F3Ã†3F8)Ãš fastapir   r   Ãšpydanticr   Ãšdotenvr   r    r"   r%   rC   Ãš
quiz_routerr
   r*   r#   rU   r   r   r   Ãº<module>rZ      ss   Ã°ÃŸ ,Ã Ã Ã³ 
Ã› Ã› 
Ã› 	Ã± â€
Ã¡Ã˜
Ã˜
Ë†Ã´â‚¬
Ã´
Â)Ã´ Ã²
EÃ° 
Ã—Ã‘Â+Ã“Ã°\eËœ;Ã² \eÃ³ Ã±\er   
