ยง
    รธNZhยง   รฃ                   รณ4  โ d dl mZmZ d dlmZ d dlZd dlZ eddgยฌยฆ  ยซ        Z  G d โ deยฆ  ยซ        Z G dโ d	eยฆ  ยซ        Z	d
e
d
e
fdโZ
d
โ Z eยฆ   ยซ          e ย
                    dยฆ  ยซ        defdโยฆ   ยซ         Ze ย
                    dยฆ  ยซ        de	fdโยฆ   ยซ         ZdS )รฉ    )ร	APIRouterร
HTTPException)ร	BaseModelNz/userรUser)รprefixรtagsc                   รณ.   โ e Zd ZU eed<   eed<   eed<   dS )r   รusernameรemailรpasswordNยฉร__name__ร
__module__ร__qualname__รstrร__annotations__ยฉ รณ    รบBC:\Users\navya\OneDrive\Desktop\edututor-ai\backend\routes\user.pyr   r      s+   โฌ โฌ โฌ โฌ โฌ โฌ รโฌMโฌMยMร
โฌJโฌJยJรโฌMโฌMยMโฌMโฌMr   c                   รณ$   โ e Zd ZU eed<   eed<   dS )ร	LoginUserr
   r   Nr
   r   r   r   r   r      s"   โฌ โฌ โฌ โฌ โฌ โฌ ร
โฌJโฌJยJรโฌMโฌMยMโฌMโฌMr   r   r   รreturnc                 รณr   โ t          j        | ย                    ยฆ   ยซ         ยฆ  ยซ        ย                    ยฆ   ยซ         S )N)ร hashlibรsha256รencodeร	hexdigest)r   s    r   ร
hash_passwordr      s(   โฌ ร
ล>ห(ลธ/ลก/ร+ร+ร
,ร
,ร
6ร
6ร
8ร
8ร8r   c                  รณร   โ t          j        dยฆ  ยซ        } | ย                    ยฆ   ยซ         }|ย                    dยฆ  ยซ         | ย                    ยฆ   ยซ          | ย                    ยฆ   ยซ          d S )Nรบ
students.dbzuCREATE TABLE IF NOT EXISTS users (
        email TEXT PRIMARY KEY,
        username TEXT,
        password TEXT
    ))ร sqlite3ร connectรcursorร executeรcommitรclose)รconnรcs     r   รinit_manual_user_dbr)      sY   โฌ ร
ล?ห=ร
)ร
)โฌDรย
ล
โฐ
ล
โฌAรโกIโIรฐ 	รฑ 
รด 
รฐ 
รฐ
 	โกKโKยMโMโฌMรโกJโJยLโLโฌLโฌLโฌLr   z	/registerรuserc                 รณร  โ t          j        dยฆ  ยซ        }|ย                    ยฆ   ยซ         }|ย                    d| j        fยฆ  ยซ         |ย                    ยฆ   ยซ         r%|ย                    ยฆ   ยซ          t          ddยฌยฆ  ยซ        โ|ย                    d| j        | j        t          | j
        ยฆ  ยซ        fยฆ  ยซ         |ย
                    ยฆ   ยซ          |ย                    ยฆ   ยซ          d d| j        โบ d	ยiS )
Nr    z!SELECT * FROM users WHERE email=?iย  zUser already existsยฉร
status_codeรdetailz>INSERT INTO users (email, username, password) VALUES (?, ?, ?)ร messageu	   รขลโฆ User z registered successfully!)r!   r"   r#   r$   r
   รfetchoner&   r   r
   r   r   r%   )r*   r'   r(   s      r   รregisterr1   )   sร   โฌ รฅ
ล?ห=ร
)ร
)โฌDรย
ล
โฐ
ล
โฌAรโกIโIร1ยฐDยดJยฐ=รAรAรAร โกzโzย|โ|รฐ Kรย
ล
โฐลหรยจร4IรJรJรJรJรโกIโIรNรลzห4ล=ยญ-ยธยผ
ร*Fร*FรGรฑIรด Iรฐ IรโกKโKยMโMโฌMรโกJโJยLโLโฌLรรKย4ยค=รKรKรKร
LรLr   z/loginc                 รณX  โ t          j        dยฆ  ยซ        }|ย                    ยฆ   ยซ         }|ย                    d| j        fยฆ  ยซ         |ย                    ยฆ   ยซ         }|ย                    ยฆ   ยซ          |r,|d         t          | j        ยฆ  ยซ        k    rdd|d         โบ d ยiS t          dd	ยฌ
ยฆ  ยซ        โ)
Nr    z2SELECT username, password FROM users WHERE email=?รฉ   r/   u   รขลโฆ Welcome back, r   รบ!iโ  zInvalid email or passwordr,   )
r!   r"   r#   r$   r
   r0   r&   r   r   r   )r*   r'   r(   รresults       r   รloginr6   9   sย   โฌ รฅ
ล?ห=ร
)ร
)โฌDรย
ล
โฐ
ล
โฌAรโกIโIรBรTรZรMรRรRรRร
ยZลZโฐ\ล\โฌFรโกJโJยLโLโฌLร 
รฐ >ย&หโ)ย}ยจTยฌ]ร;ร;ร;ร;รร<ยฐยฐqยด	ร<ร<ร<ร=ร=ร
ยCร0Kร
Lร
Lร
LรLr   )ร fastapir   r   รpydanticr   r!   r   รuser_auth_routerr   r   r   r   r)   รpostr1   r6   r   r   r   รบ<module>r;      sx  รฐร ,ร ,ร ,ร ,ร ,ร ,ร ,ร ,ร ร ร ร ร ร ร โฌโฌโฌร โฌโฌโฌรย9ร
ร
หรฐรฑ รด ร รฐรฐ รฐ รฐ รฐ ห9รฑ รด รฐ รฐรฐ รฐ รฐ รฐ ย	รฑ รด รฐ รฐ
9หCรฐ 9ยCรฐ 9รฐ 9รฐ 9รฐ 9รฐ	รฐ 	รฐ 	รฐ ร ร ร ร รฐ รรย{ร#ร#รฐMย4รฐ Mรฐ Mรฐ Mรฑ $ร#รฐMรฐ รรยxร ร รฐ	Mย	รฐ 	Mรฐ 	Mรฐ 	Mรฑ !ร รฐ	Mรฐ 	Mรฐ 	Mr   
